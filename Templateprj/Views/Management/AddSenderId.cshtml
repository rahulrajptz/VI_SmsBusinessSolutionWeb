@model Templateprj.Models.Managements.AddSenderModel
@{
    System.Data.DataTable project = ViewBag.inboundData;

    ViewBag.Title = "Management";
}

<style>
    table.dataTable > tbody > tr > td, table.dataTable > tbody > tr > th, table.dataTable > tfoot > tr > td, table.dataTable > tfoot > tr > th, table.dataTable > thead > tr > td, table.dataTable > thead > tr > th {
        padding: 5px !important;
        outline: 0;
        max-width: 150px;
        width: 150px;
        border-right: 0;
        border-bottom: 0;
        color: black;
    }

    table.dataTable thead > tr > td.sorting, table.dataTable thead > tr > td.sorting_asc, table.dataTable thead > tr > td.sorting_desc, table.dataTable thead > tr > th.sorting, table.dataTable thead > tr > th.sorting_asc, table.dataTable thead > tr > th.sorting_desc {
        font-size: 9.5pt;
        text-align: center;
        font-weight: bold;
        white-space: nowrap !important;
        table-layout: fixed;
        color: black;
    }


    .alert-danger {
        color: white;
    }

    .alert-success {
        color: white;
    }

    hr {
        border: 1px solid #5f004b
    }

    .box {
        /*border: 1px solid #878080;*/
        padding: 20px;
        box-shadow: rgba(0, 0, 0, 0.35) 1px 5px 10px;
        /*min-height: 150px;*/
        /*width:25%;*/
    }

    .blue {
        width: 60%;
        background-color: #57b4eb;
    }

    .yellow {
        width: 30%;
        background-color: yellow;
    }

    .red {
        width: 10%;
        background-color: red;
    }

    .head {
        position: sticky;
        top: 0;
        z-index: 5;
    }

    body {
        font-size: 13px !important;
    }

    .form-control {
        border-radius: 10px;
        height: 20px !important;
        padding: 0px 5px !important;
        font-size: 12px !important;
        background-color: white !important;
        /*color:#5f004b;*/
    }

    .form-group {
        margin-bottom: 4px;
        border-radius: 10px;
    }



    .navstyle {
        border: 0px solid black;
    }

        .navstyle > ul > li {
            border: 1px solid #5f004b;
            /*background-color: #5f004b;*/
            margin-left: 5px;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
            width: 200px;
        }

    a {
        color: grey;
    }

        a:hover {
            color: white;
        }

    .active {
        background-color: #5f004b;
        color: white;
    }

        .active:hover {
            background-color: #5f004b;
            color: white;
        }

    .nav-link {
        border-top-right-radius: 10px;
        border-top-left-radius: 10px;
    }

    label {
        color: #5f004b;
        font-size: 12px;
    }

    .label_side_head {
        color: #5f004b;
        font-size: 12px;
        font-weight: bold;
    }

    .navclr:hover {
        background-color: #ebecf1;
    }

    .navclr {
        background-color: #ebecf1;
    }
    /*.dropdown-toggle {
        float: right;
    }*/
    .cl-black {
        color: #495057 !important;
    }

    .text-danger {
        width: 109px;
        font-size: 10px;
        height: 0px;
    }

    labelvariable {
        color: #5f004b;
        font-size: 12px;
    }

    .button-edit {
        /*background-color: #5f004b;*/
        border-radius: 10px;
        /*border-bottom-color: #5f004b;*/
        color: white;
        padding: 8px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        min-width: 65px !important;
    }
</style>

<div class="row" style="margin-top:50px">
    <div class="col">

        @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", id = "senderform" }))
        {
            <div class="container" style="margin-left:10px">
                <div class="row">
                    <div class="wizard-navigation">
                        <div class="col-xs-12 navstyle">
                            <ul class="nav">
                                <li class="nav-item" style="width: 130px;height:35px">
                                    <a style="font-size:12px;font-weight:bold;" class="nav-link" href="@Url.Action("Account", "Management")">
                                        <span class="now-ui-icons loader_gear sidebar-mini-icon mt-1"></span>
                                        ACCOUNT
                                    </a>
                                </li>
                                <li class="nav-item " style="width: 140px;height:35px">
                                    <a style="font-size:12px;font-weight:bold;" class="nav-link" href="@Url.Action("Templates", "Template")">
                                        <span class="now-ui-icons loader_gear sidebar-mini-icon mt-1"></span>
                                        TEMPLATES
                                    </a>
                                </li>
                                <li class="nav-item arrow" style="width: 150px;height:35px">
                                    <a style="font-size:12px;font-weight:bold;" class="nav-link active" href="@Url.Action("SenderIds", "SenderId")">
                                        <span class="now-ui-icons loader_gear sidebar-mini-icon mt-1"></span>
                                        SENDER ID
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" style="margin-left:15px;margin-top:10px;">
                <div class="tab-pane show active navclr">
                    <div class="row" id="divAdd" style="background-color:white;">
                        <div class="col-md-12">
                            @if (!ViewBag.IsEdit)
                            {
                                <p>
                                    <a class="btn btn-block text-white dropdown-toggle" style="text-align:left;background-color:grey;font-size:9.2846px"
                                       data-toggle="collapse" href="#addUpload" role="button" aria-expanded=@(ViewBag.IsEdit ? "true" : "false")>
                                        ADD SENDER ID
                                    </a>
                                </p>
                            }
                            <div class="collapse" id="addUpload">
                                <div class="col">
                                    <div class="row">
                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Header Id")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.HeaderId, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")), @maxlength = "25" })
                                                @Html.HiddenFor(m => m.SmId)
                                            </div>
                                        </div>

                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Sender Id")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.SenderId, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")), @maxlength = "6" })
                                            </div>
                                        </div>

                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Tele Marketer")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.TeleMarketer, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })

                                            </div>
                                        </div>

                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("RegisteredTsp")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.RegisteredTsp, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Requested On")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.RequestedDate, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })

                                            </div>
                                        </div>

                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Status Date")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.StatusDate, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })
                                            </div>
                                        </div>

                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("Status")<span style="color:red">*</span>
                                            <div class="form-group">
                                                @Html.DropDownListFor(m => m.Status, Model.ApprovalStatus, new { @class = "form-control w-100" })
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-6 col-6">
                                            @Html.Label("BlackListed By")
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.BlackListedBy, new { @class = "form-control w-100", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })
                                            </div>
                                        </div>

                                    </div>


                                    <div class="row">
                                        <div class="col-12">
                                            @Html.Label("Explanation")
                                            <div class="form-group">
                                                @Html.TextAreaFor(m => m.Explanation, new { @class = "w-100", @rows = "4", @disabled = ((ViewBag.IsEdit ? "disabled" : "")) })

                                            </div>
                                        </div>

                                    </div>

                                    @if (!ViewBag.IsEdit)
                                    {
                                        <div class="row">
                                            <div class="col-12" style="text-align:right">
                                                <button class="btn-success mt-1" id="addSender" style="background:linear-gradient(90deg,#0077b3 0,#0099e6 60%,#0077b3);" type="button">Add Sender Id</button>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="row">
                                            <div class="col-12" style="text-align:right">
                                                <button class="btn-success mt-1" id="updateSender" style="background:linear-gradient(90deg,#0077b3 0,#0099e6 60%,#0077b3);" type="button">Update</button>
                                            </div>
                                        </div>
                                    }

                                </div>
                            </div>
                        </div>
                        @if (!ViewBag.IsEdit)
                        {
                            <div class="col-md-12">
                                <div class="row" id="divUpload">
                                    <div class="col-md-12">
                                        <p>
                                            <a class="btn btn-block text-white dropdown-toggle" style="text-align:left;background-color:grey;font-size:9.2846px"
                                               data-toggle="collapse" href="#collapseupload" role="button" aria-expanded="false">
                                                UPLOAD SENDER IDS
                                            </a>
                                        </p>
                                        <div class="collapse ml-5" id="collapseupload">

                                            <div id="fileUploadm2m">
                                                <div class="row">
                                                    <div class="col" style="text-align:right;">
                                                        <a id="samplefiledownlod" style="color:#5f004b;font-size:13px" href="~/Uploads/SenderIdSampleFile.xlsx"><span class="now-ui-icons files_single-copy-04"></span>Sample File</a>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-4" style="text-align:left;">
                                                        <span>@Html.Label("Upload Sender Ids") </span>
                                                        <input style="width:234px;font-size:13px;color:#5f004b;" id="fileToUpload" type="file" name="file" required="required">

                                                    </div>
                                                    <div class="col-4">
                                                        <button class="btn-success" id="uploadfileid" style="background:linear-gradient(90deg,#0077b3 0,#0099e6 60%,#0077b3);" type="button">Upload</button>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="row" id="divSummary" style="display:none">
                        <div class="col">
                            <span class="btn btn-primary">
                                Total <span class="badge badge-light" id="spnTotal">0</span>
                            </span>
                            <span class="btn btn-danger">
                                Duplicate <span class="badge badge-light" id="spnDuplicate">0</span>
                            </span>
                            <table class="table" id="alertTable">
                                <thead class="thead-dark">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">TemplateId</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        }

    </div>
</div>
@section scripts {

    <link href="~/Scripts/virtualkeyboard/keyboard.css" rel="stylesheet" />
    <script type="text/javascript" src="~/Scripts/virtualkeyboard/keyboard.js" charset="UTF-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {

            $("#addSender").click(function (e) {
                //Serialize the form datas.
                var valdata = $("#senderform").serialize();
                if (isValid()) {
                    $.ajax({
                        url: '@Url.Action(MVC.SenderId.SenderIds())',
                        type: "POST",
                        dataType: 'json',
                        contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                        data: valdata
                        , success: function (e) {
                            jsondata = JSON.parse(e);
                          
                            if (jsondata.status == "1") {
                                $('#divSummary').hide();
                                $('#divAdd').show();
                                window.location.href = '@Url.Action(MVC.SenderId.SenderIds())';
                            }
                            else if (jsondata.status == "2") {
                                $('#divSummary').show();
                                $('#divAdd').hide();
                                $('#addUpload').hide();
                                ErrorMsg(jsondata.response)
                                $('#spnTotal').text(jsondata.data.Total);
                                $('#spnDuplicate').text(jsondata.data.Duplicate);
                                $.each(jsondata.data.Data, function (index, val) {
                                    addRow(index + 1, val.PId);
                                });
                            } else {
                                ErrorMsg(jsondata.response)
                            }
                        }
                    });
                }
            });

            function isValid() {
                if ($("#SenderId").val().length > 6) {
                    ErrorMsg("Sender Id maximum length exceeded.")
                    return false;
                }
                else if ($("#HeaderId").val().length > 25) {
                    ErrorMsg("Header Id maximum length exceeded.")
                    return false;
                }
                else if (!($("#SenderId").val() && $("#HeaderId").val() && $("#TeleMarketer").val()
                    && $("#RegisteredTsp").val() && $("#RequestedDate").val()
                    && $("#StatusDate").val() && $("#Status").val()))
                {
                    ErrorMsg("Please confirm the entries, there are some mandatory fields missing.")
                    return false;
                }
                else {
                    return true;
                }
            }

            setInputFilter(document.getElementById("HeaderId"), function (value) {
                return /^-?\d*$/.test(value);
            });

            // Restricts input for the given textbox to the given inputFilter.
            function setInputFilter(textbox, inputFilter) {
                ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function (event) {
                    textbox.addEventListener(event, function () {
                        if (inputFilter(this.value)) {
                            this.oldValue = this.value;
                            this.oldSelectionStart = this.selectionStart;
                            this.oldSelectionEnd = this.selectionEnd;
                        } else if (this.hasOwnProperty("oldValue")) {
                            this.value = this.oldValue;
                            this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                        } else {
                            this.value = "";
                        }
                    });
                });
            }
        });
    </script>

    <script>
        $("#RequestedDate").flatpickr({
            dateFormat: "d/m/Y",
        });

        $("#StatusDate").flatpickr({
            dateFormat: "d/m/Y",
        });
    </script>

    @*Docuemtn ready*@
    <script type="text/javascript">

                $(document).ready(function ()
                {
                    if ('@ViewBag.IsEdit' === 'False') {
                        $("input").removeAttr('disabled', 'disabled');
                        $("textarea").removeAttr('disabled', 'disabled');
                    } else {
                        $("#addUpload").collapse('show');
                    }

               });
    </script>

    @*Upload Sender File*@
<script>

             $('#uploadfileid').on('click', function () {

                 if ($("#senderform").valid()) {

                var fileUpload = $("#fileToUpload").get(0);

                var files = fileUpload.files;

                var fileData = new FormData();
                const fsize = files[0].size;
                console.log(fsize);
                const filesizeinkb = Math.round((fsize / 1024));

                if (filesizeinkb >= 100000) {
                    ErrorMsg("File is too large,Please upload file less than 100 MB")
                }
                else {
                    fileData.append(files[0].name, files[0]);
                    fileData.append("CampaignId", $("#uploadCampaignName").val());
                    fileData.append("starttype", $("#uploadCampaignstarttype").val());
                    $.ajax({
                        url: '@Url.Action(MVC.SenderId.UploadSenderIds())',
                        type: 'post',
                        datatype: 'json',
                        contentType: false,
                        processData: false,
                        async: false,
                        data: fileData,
                        success: function (e) {
                            jsondata = JSON.parse(e);
                            if (jsondata.status == "1") {
                                $('#divSummary').hide();
                                $('#divAdd').show();
                                window.location.href = '@Url.Action(MVC.SenderId.SenderIds())';
                            } 
                                else if (jsondata.status == "2") {
                                $('#divSummary').show();
                                $('#divAdd').hide();
                                $('#addUpload').hide();
                                ErrorMsg("Failed to save details.")
                                $('#spnTotal').text(jsondata.data.Total);
                                $('#spnDuplicate').text(jsondata.data.Duplicate);
                                $.each(jsondata.data.Data, function (index, val) {
                                    addRow(index + 1, val.PId);
                                });
                            } else {
                                ErrorMsg(jsondata.response)
                            }
                        }
                    });
                }
            }
            else {
                ErrorMsg("Please fill in all fields.")
            }

        });

</script>

    @*Update Sender*@
<script>
        $(document).on('click', '#updateSender', function (e) {
                var templateModel = {};
                var isValid = true;
            templateModel.smId = $("#SmId").val();
                templateModel.status = $("#Status").val();

                if (isValid) {
                    $.ajax({
                        url: '@Url.Action(MVC.SenderId.SenderIds())',
                        type: 'PUT',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(templateModel),
                        success: function (e) {
                            jsondata = JSON.parse(e);
                            if (jsondata.status == "1") {
                                SuccessMsg("Successfully update senderId details");
                            }
                            else {
                                ErrorMsg("Failed to upate senderId details.")
                            }
                        }
                    });
                }
                else {
                    ErrorMsg("Please confirm the entries, there are some alerts exist.")
                }
        });
</script>

    <script>
        function addRow(rid, tid) {
            var table = document.getElementById("alertTable"); //get the table
            var rowcount = table.rows.length; //get no. of rows in the table
            //append the controls in the row
            var tblRow = '<tr><th scope = "row"> ' + rid + '</th><td>' + tid + '</td></tr >';
            $("#alertTable").append(tblRow);
        }

    </script>
}
